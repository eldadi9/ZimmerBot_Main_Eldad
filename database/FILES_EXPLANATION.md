# ğŸ“š ×”×¡×‘×¨ ××¤×•×¨×˜ ×¢×œ ×›×œ ×”×§×‘×¦×™× ×‘×ª×™×§×™×™×ª `database/`

## ğŸ“‹ ×§×‘×¦×™ ×‘×“×™×§×” (Test Scripts)

### 1. `check_stage1.py`
**×ª×¤×§×™×“:** ×‘×“×™×§×ª ×©×œ×‘ 1 - ××•×“×œ × ×ª×•× ×™× (Database Schema)
- **××” ×”×•× ×‘×•×“×§:**
  - ×§×™×•× ×›×œ ×”×˜×‘×œ××•×ª ×”× ×“×¨×©×•×ª (cabins, customers, bookings, pricing_rules, transactions, notifications, audit_log)
  - ×§×™×•× Foreign Keys (×§×©×¨×™× ×‘×™×Ÿ ×˜×‘×œ××•×ª)
  - ×§×™×•× Indexes (××¤×ª×—×•×ª ×—×™×¤×•×©)
  - Constraints (××™×œ×•×¦×™×)
  - ×™×›×•×œ×ª CRUD (×™×¦×™×¨×”, ×§×¨×™××”, ×¢×“×›×•×Ÿ, ××—×™×§×”)
- **××™×š ×œ×”×¨×™×¥:** `python database/check_stage1.py`
- **××ª×™ ×œ×”×©×ª××©:** ××—×¨×™ ×™×¦×™×¨×ª ××¡×“ ×”× ×ª×•× ×™× ×•×”×¨×¦×ª `schema.sql`

### 2. `check_stage2.py`
**×ª×¤×§×™×“:** ×‘×“×™×§×ª ×©×œ×‘ 2 - ×—×™×‘×•×¨ ×œ×™×•××Ÿ Google Calendar ×•×‘×“×™×§×ª ×–××™× ×•×ª
- **××” ×”×•× ×‘×•×“×§:**
  - ×—×™×‘×•×¨ ×œ-Google Calendar API
  - ×§×¨×™××ª ×¦×™××¨×™× ×-Google Sheets
  - ×¨×©×™××ª ××™×¨×•×¢×™× ×‘×™×•××Ÿ
  - ×™×¦×™×¨×ª ××™×¨×•×¢ ×—×“×©
  - ×‘×“×™×§×ª ×–××™× ×•×ª ×¦×™××¨
- **××™×š ×œ×”×¨×™×¥:** `python database/check_stage2.py`
- **××ª×™ ×œ×”×©×ª××©:** ××—×¨×™ ×”×’×“×¨×ª Google Calendar credentials

### 3. `check_stage3.py`
**×ª×¤×§×™×“:** ×‘×“×™×§×ª ×©×œ×‘ 3 - ×× ×•×¢ ×ª××—×•×¨ (Pricing Engine)
- **××” ×”×•× ×‘×•×“×§:**
  - ×—×™×©×•×‘ ××—×™×¨ ×‘×¡×™×¡×™
  - ×—×™×©×•×‘ ××—×™×¨ ×¡×•×¤"×©
  - ×—×™×©×•×‘ ××—×™×¨ ×—×’
  - ×—×™×©×•×‘ ××—×™×¨ ×¢×•× ×” ×’×‘×•×”×”
  - ×—×™×©×•×‘ ×ª×•×¡×¤×•×ª (addons)
  - ×”× ×—×•×ª
- **××™×š ×œ×”×¨×™×¥:** `python database/check_stage3.py`
- **××ª×™ ×œ×”×©×ª××©:** ××—×¨×™ ×”×ª×§× ×ª `src/pricing.py`

### 4. `check_stage4.py`
**×ª×¤×§×™×“:** ×‘×“×™×§×ª ×©×œ×‘ 4 - ×× ×’× ×•×Ÿ Hold (×”×—×–×§×ª ×¦×™××¨)
- **××” ×”×•× ×‘×•×“×§:**
  - ×—×™×‘×•×¨ ×œ-Redis
  - ×™×¦×™×¨×ª Hold
  - ×©×—×¨×•×¨ Hold
  - ×”××¨×ª Hold ×œ×”×–×× ×”
  - ×× ×™×¢×ª ×”×–×× ×” ×›×¤×•×œ×”
- **××™×š ×œ×”×¨×™×¥:** `python database/check_stage4.py`
- **××ª×™ ×œ×”×©×ª××©:** ××—×¨×™ ×”×ª×§× ×ª Redis ×•×”×’×“×¨×ª `src/hold.py`
- **×”×¢×¨×”:** ×“×•×¨×© Redis ××•×ª×§×Ÿ ×•×¤×•×¢×œ

### 5. `full_flow_test.py`
**×ª×¤×§×™×“:** ×‘×“×™×§×” ××œ××” end-to-end ×©×œ ×›×œ ×”×ª×”×œ×™×š
- **××” ×”×•× ×‘×•×“×§:**
  1. ×§×¨×™××” ×-Google Sheets
  2. ×™×™×‘×•× ×œ-DB
  3. ×§×¨×™××” ×-DB
  4. ×‘×“×™×§×ª ×–××™× ×•×ª
  5. ×™×¦×™×¨×ª Hold
  6. ×”××¨×ª Hold ×œ×”×–×× ×”
- **××™×š ×œ×”×¨×™×¥:** `python database/full_flow_test.py`
- **××ª×™ ×œ×”×©×ª××©:** ×‘×“×™×§×” ×¡×•×¤×™×ª ××—×¨×™ ×©×›×œ ×”×©×œ×‘×™× ×¢×•×‘×“×™×

### 6. `test_api_endpoints.py`
**×ª×¤×§×™×“:** ×‘×“×™×§×ª ×›×œ ×”-API endpoints
- **××” ×”×•× ×‘×•×“×§:**
  - `/health` - ×‘×¨×™××•×ª ×”×©×¨×ª
  - `/cabins` - ×¨×©×™××ª ×¦×™××¨×™×
  - `/availability` - ×‘×“×™×§×ª ×–××™× ×•×ª
  - `/quote` - ×”×¦×¢×ª ××—×™×¨
  - `/book` - ×™×¦×™×¨×ª ×”×–×× ×”
  - `/admin/bookings` - ×¨×©×™××ª ×”×–×× ×•×ª
  - `/admin/audit` - ×œ×•×’×™×
- **××™×š ×œ×”×¨×™×¥:** `python database/test_api_endpoints.py`
- **××ª×™ ×œ×”×©×ª××©:** ××—×¨×™ ×©×”×©×¨×ª ×¨×¥ (`run_api.bat`)
- **×“×¨×™×©×”:** ×”×©×¨×ª ×¦×¨×™×š ×œ×¨×•×¥ ×¢×œ `http://127.0.0.1:8000`

### 7. `show_all_data.py`
**×ª×¤×§×™×“:** ×”×¦×’×ª ×›×œ ×”× ×ª×•× ×™× ×‘××¡×“ ×”× ×ª×•× ×™×
- **××” ×”×•× ××¦×™×’:**
  - ×¨×©×™××ª ×›×œ ×”×¦×™××¨×™×
  - ×¨×©×™××ª ×›×œ ×”×œ×§×•×—×•×ª
  - ×¨×©×™××ª ×›×œ ×”×”×–×× ×•×ª
  - ×¨×©×™××ª ×›×œ ×”×ª×©×œ×•××™×
  - ×¨×©×™××ª ×›×œ ×”×œ×•×’×™×
- **××™×š ×œ×”×¨×™×¥:** `python database/show_all_data.py`
- **××ª×™ ×œ×”×©×ª××©:** ×œ×‘×“×™×§×” ××”×™×¨×” ×©×œ ××” ×™×© ×‘××¡×“ ×”× ×ª×•× ×™×

---

## ğŸ“¥ ×§×‘×¦×™ ×™×™×‘×•× (Import Scripts)

### 8. `import_cabins_to_db.py`
**×ª×¤×§×™×“:** ×™×™×‘×•× ×¦×™××¨×™× ×-Google Sheets ×œ××¡×“ ×”× ×ª×•× ×™× PostgreSQL
- **××” ×”×•× ×¢×•×©×”:**
  1. ×§×•×¨× ×¦×™××¨×™× ×-Google Sheets
  2. ×××™×¨ ××•×ª× ×œ×¤×•×¨××˜ DB
  3. ×™×•×¦×¨ UUID ×“×˜×¨××™× ×™×¡×˜×™ ×-cabin_id ×”××§×•×¨×™ (ZB01, ZB02, ×•×›×•')
  4. ×©×•××¨ ×‘-`cabins` table
  5. ××¢×“×›×Ÿ `cabin_id_string` ×¢× ×”-ID ×”××§×•×¨×™
- **××™×š ×œ×”×¨×™×¥:** `python database/import_cabins_to_db.py`
- **××ª×™ ×œ×”×©×ª××©:** ×‘×¤×¢× ×”×¨××©×•× ×” ××• ×›×©××¢×“×›× ×™× ×¦×™××¨×™× ×‘-Sheets
- **×”×¢×¨×”:** ×× ×”×¦×™××¨ ×›×‘×¨ ×§×™×™× (×œ×¤×™ UUID, calendar_id, ××• name), ×”×•× ×™×¢×•×“×›×Ÿ

### 9. `import_bookings_from_calendar.py`
**×ª×¤×§×™×“:** ×™×™×‘×•× ×”×–×× ×•×ª ×§×™×™××•×ª ×-Google Calendar ×œ××¡×“ ×”× ×ª×•× ×™×
- **××” ×”×•× ×¢×•×©×”:**
  1. ×§×•×¨× ××™×¨×•×¢×™× ××›×œ ×™×•×× ×™ Google Calendar
  2. ××¤×¨×¡×¨ ××ª ×ª×™××•×¨ ×”××™×¨×•×¢ (description) ×œ×—×™×œ×•×¥ ×¤×¨×˜×™×
  3. ×™×•×¦×¨ ×œ×§×•×— ×—×“×© ××• ××•×¦× ×§×™×™×
  4. ×™×•×¦×¨ ×”×–×× ×” ×—×“×©×” ×‘-DB
  5. ×©×•××¨ `event_id` ×•-`event_link`
- **××™×š ×œ×”×¨×™×¥:** `python database/import_bookings_from_calendar.py`
- **××ª×™ ×œ×”×©×ª××©:** ×‘×¤×¢× ×”×¨××©×•× ×” ×›×“×™ ×œ×”×¢×‘×™×¨ ×”×–×× ×•×ª ×§×™×™××•×ª ××”-Calendar ×œ-DB
- **×”×¢×¨×”:** ×× ×¡×” ×œ×—×œ×¥ ×¤×¨×˜×™× ××ª×™××•×¨ ×”××™×¨×•×¢ (Cabin, Customer, Phone, ×•×›×•')

---

## ğŸ”§ ×§×‘×¦×™ ×ª×™×§×•×Ÿ (Fix Scripts)

### 10. `fix_calendar_ids.py`
**×ª×¤×§×™×“:** ×ª×™×§×•×Ÿ `calendar_id` ×‘-DB ×œ×¤×™ Google Sheets
- **××” ×”×•× ×¢×•×©×”:**
  1. ×§×•×¨× ×¦×™××¨×™× ×-Google Sheets
  2. ×§×•×¨× ×¦×™××¨×™× ×-DB
  3. ××ª××™× ×‘×™×Ÿ Sheets ×œ-DB ×œ×¤×™ ×©× ×”×¦×™××¨
  4. ××¢×“×›×Ÿ `calendar_id` ×‘-DB ×œ×¤×™ ××” ×©×™×© ×‘-Sheets
- **××™×š ×œ×”×¨×™×¥:** `python database/fix_calendar_ids.py`
- **××ª×™ ×œ×”×©×ª××©:** ×× `calendar_id` ×‘-DB ×œ× ×ª×•×× ×œ-Sheets

---

## ğŸ—„ï¸ ×§×‘×¦×™ SQL (Database Schema)

### 11. `schema.sql`
**×ª×¤×§×™×“:** ×™×¦×™×¨×ª ×›×œ ×”×˜×‘×œ××•×ª ×‘××¡×“ ×”× ×ª×•× ×™×
- **××” ×”×•× ××›×™×œ:**
  - `cabins` - ×˜×‘×œ×ª ×¦×™××¨×™×
  - `customers` - ×˜×‘×œ×ª ×œ×§×•×—×•×ª
  - `bookings` - ×˜×‘×œ×ª ×”×–×× ×•×ª
  - `quotes` - ×˜×‘×œ×ª ×”×¦×¢×•×ª ××—×™×¨
  - `pricing_rules` - ×˜×‘×œ×ª ×›×œ×œ×™ ×ª××—×•×¨
  - `transactions` - ×˜×‘×œ×ª ×ª×©×œ×•××™×
  - `notifications` - ×˜×‘×œ×ª ×”×•×“×¢×•×ª
  - `audit_log` - ×˜×‘×œ×ª ×œ×•×’×™×
  - Foreign Keys, Indexes, Constraints
- **××™×š ×œ×”×¨×™×¥:** `psql -U postgres -d zimmerbot_db -f database/schema.sql`
- **××ª×™ ×œ×”×©×ª××©:** ×‘×¤×¢× ×”×¨××©×•× ×” ××• ×›×©×¦×¨×™×š ×œ×™×¦×•×¨ ××—×“×© ××ª ×”××¡×“

### 12. `schema_stage1.sql`
**×ª×¤×§×™×“:** ×’×¨×¡×” ××•×§×“××ª ×©×œ schema (×œ××˜×¨×•×ª ×”×™×¡×˜×•×¨×™×•×ª)
- **×”×¢×¨×”:** ×œ× ×‘×©×™××•×© ×¤×¢×™×œ, × ×©××¨ ×œ××˜×¨×•×ª ×’×™×‘×•×™

### 13. `schema_stage1_fix_names.sql`
**×ª×¤×§×™×“:** ×ª×™×§×•×Ÿ ×©××•×ª ×˜×‘×œ××•×ª (×œ××˜×¨×•×ª ×”×™×¡×˜×•×¨×™×•×ª)
- **×”×¢×¨×”:** ×œ× ×‘×©×™××•×© ×¤×¢×™×œ, × ×©××¨ ×œ××˜×¨×•×ª ×’×™×‘×•×™

### 14. `add_cabin_id_string.sql`
**×ª×¤×§×™×“:** ×”×•×¡×¤×ª ×¢××•×“×” `cabin_id_string` ×œ×˜×‘×œ×ª `cabins`
- **××” ×”×•× ×¢×•×©×”:**
  - ××•×¡×™×£ ×¢××•×“×” `cabin_id_string VARCHAR(20)`
  - ×™×•×¦×¨ index ×¢×œ ×”×¢××•×“×”
- **××™×š ×œ×”×¨×™×¥:** `psql -U postgres -d zimmerbot_db -f database/add_cabin_id_string.sql`
- **××ª×™ ×œ×”×©×ª××©:** ×× ×”×¢××•×“×” ×œ× ×§×™×™××ª (××‘×œ `import_cabins_to_db.py` ×›×‘×¨ ×¢×•×©×” ××ª ×–×”)

### 15. `migration_add_event_fields.sql`
**×ª×¤×§×™×“:** ×”×•×¡×¤×ª `event_id` ×•-`event_link` ×œ×˜×‘×œ×ª `bookings`
- **××” ×”×•× ×¢×•×©×”:**
  - ××•×¡×™×£ ×¢××•×“×•×ª `event_id` ×•-`event_link` ×œ-`bookings`
  - ×™×•×¦×¨ ×˜×‘×œ×ª `quotes` ×× ×œ× ×§×™×™××ª
  - ×™×•×¦×¨ indexes
- **××™×š ×œ×”×¨×™×¥:** `psql -U postgres -d zimmerbot_db -f database/migration_add_event_fields.sql`
- **××ª×™ ×œ×”×©×ª××©:** ×× ×”×¢××•×“×•×ª ×œ× ×§×™×™××•×ª (××‘×œ `run_migration.py` ×›×‘×¨ ×¢×•×©×” ××ª ×–×”)

---

## ğŸš€ ×§×‘×¦×™ ×”×¨×¦×” (Run Scripts)

### 16. `run_migration.py`
**×ª×¤×§×™×“:** ×”×¨×¦×ª migration ×œ×”×•×¡×¤×ª `event_id` ×•-`event_link`
- **××” ×”×•× ×¢×•×©×”:** ×›××• `migration_add_event_fields.sql` ××‘×œ ×“×¨×š Python
- **××™×š ×œ×”×¨×™×¥:** `python database/run_migration.py`
- **××ª×™ ×œ×”×©×ª××©:** ×× ×¦×¨×™×š ×œ×”×¨×™×¥ migration ×“×¨×š Python

### 17. `run_check.bat` / `run_check.sh`
**×ª×¤×§×™×“:** ×”×¨×¦×ª ×›×œ ×‘×“×™×§×•×ª ×”×©×œ×‘×™× (1-4)
- **××” ×”×•× ×¢×•×©×”:** ××¨×™×¥ `check_stage1.py`, `check_stage2.py`, `check_stage3.py`, `check_stage4.py`
- **××™×š ×œ×”×¨×™×¥:** Windows: `database\run_check.bat` | Linux/Mac: `bash database/run_check.sh`
- **××ª×™ ×œ×”×©×ª××©:** ×‘×“×™×§×” ××œ××” ×©×œ ×›×œ ×”×©×œ×‘×™×

### 18. `run_check_stage2.bat` / `run_check_stage2.sh`
**×ª×¤×§×™×“:** ×”×¨×¦×ª ×‘×“×™×§×ª ×©×œ×‘ 2 ×‘×œ×‘×“
- **××™×š ×œ×”×¨×™×¥:** Windows: `database\run_check_stage2.bat` | Linux/Mac: `bash database/run_check_stage2.sh`

### 19. `run_check_stage3.bat` / `run_check_stage3.sh` / `run_check_stage3.ps1`
**×ª×¤×§×™×“:** ×”×¨×¦×ª ×‘×“×™×§×ª ×©×œ×‘ 3 ×‘×œ×‘×“
- **××™×š ×œ×”×¨×™×¥:** Windows: `database\run_check_stage3.bat` ××• `powershell database/run_check_stage3.ps1` | Linux/Mac: `bash database/run_check_stage3.sh`

### 20. `run_check_stage4.bat`
**×ª×¤×§×™×“:** ×”×¨×¦×ª ×‘×“×™×§×ª ×©×œ×‘ 4 ×‘×œ×‘×“
- **××™×š ×œ×”×¨×™×¥:** `database\run_check_stage4.bat`

### 21. `run_import_cabins.bat`
**×ª×¤×§×™×“:** ×”×¨×¦×ª ×™×™×‘×•× ×¦×™××¨×™×
- **××™×š ×œ×”×¨×™×¥:** `database\run_import_cabins.bat`

### 22. `run_import_bookings.bat`
**×ª×¤×§×™×“:** ×”×¨×¦×ª ×™×™×‘×•× ×”×–×× ×•×ª
- **××™×š ×œ×”×¨×™×¥:** `database\run_import_bookings.bat`

### 23. `run_fix_calendar_ids.bat`
**×ª×¤×§×™×“:** ×”×¨×¦×ª ×ª×™×§×•×Ÿ calendar_id
- **××™×š ×œ×”×¨×™×¥:** `database\run_fix_calendar_ids.bat`

### 24. `run_test_api.bat`
**×ª×¤×§×™×“:** ×”×¨×¦×ª ×‘×“×™×§×ª API endpoints
- **××™×š ×œ×”×¨×™×¥:** `database\run_test_api.bat`
- **×“×¨×™×©×”:** ×”×©×¨×ª ×¦×¨×™×š ×œ×¨×•×¥ ×¢×œ `http://127.0.0.1:8000`

### 25. `fix_token_scopes.bat`
**×ª×¤×§×™×“:** ×ª×™×§×•×Ÿ scopes ×©×œ Google OAuth token
- **××” ×”×•× ×¢×•×©×”:** ××•×—×§ ××ª `token_api.json` ×›×“×™ ×œ×›×¤×•×ª re-authentication ×¢× scopes ×—×“×©×™×
- **××™×š ×œ×”×¨×™×¥:** `database\fix_token_scopes.bat`
- **××ª×™ ×œ×”×©×ª××©:** ×× ×™×© ×©×’×™××ª permissions ×‘-Google API

---

## ğŸ“– ×§×‘×¦×™ ×ª×™×¢×•×“

### 26. `README.md`
**×ª×¤×§×™×“:** ××“×¨×™×š ×‘×“×™×§×” ×œ×©×œ×‘ 1
- **××” ×”×•× ××›×™×œ:** ×”×•×¨××•×ª ××¤×•×¨×˜×•×ª ××™×š ×œ×‘×“×•×§ ××ª ×©×œ×‘ 1

---

## ğŸ” ×¡×™×›×•× - ××ª×™ ×œ×”×©×ª××© ×‘×›×œ ×§×•×‘×¥

### ×‘×¤×¢× ×”×¨××©×•× ×” (Setup):
1. `schema.sql` - ×™×¦×™×¨×ª ××¡×“ ×”× ×ª×•× ×™×
2. `import_cabins_to_db.py` - ×™×™×‘×•× ×¦×™××¨×™×
3. `import_bookings_from_calendar.py` - ×™×™×‘×•× ×”×–×× ×•×ª ×§×™×™××•×ª
4. `check_stage1.py` - ×‘×“×™×§×” ×©×”×›×œ ×¢×•×‘×“

### ×‘×“×™×§×•×ª ×ª×§×•×¤×ª×™×•×ª:
- `test_api_endpoints.py` - ×‘×“×™×§×ª API
- `show_all_data.py` - ×”×¦×’×ª × ×ª×•× ×™×
- `full_flow_test.py` - ×‘×“×™×§×” ××œ××”

### ×ª×™×§×•× ×™×:
- `fix_calendar_ids.py` - ×× calendar_id ×œ× ×ª×•××
- `fix_token_scopes.bat` - ×× ×™×© ×‘×¢×™×™×ª permissions

### Migrations:
- `run_migration.py` - ×× ×¦×¨×™×š ×œ×”×•×¡×™×£ ×¢××•×“×•×ª ×—×“×©×•×ª

---

## âš ï¸ ×”×¢×¨×•×ª ×—×©×•×‘×•×ª

1. **×¡×“×¨ ×”×¨×¦×” ×—×©×•×‘:**
   - ×§×•×“× `schema.sql`
   - ××—×¨ ×›×š `import_cabins_to_db.py`
   - ××—×¨ ×›×š `import_bookings_from_calendar.py`

2. **×“×¨×™×©×•×ª:**
   - PostgreSQL ××•×ª×§×Ÿ ×•×¤×•×¢×œ
   - Google Calendar credentials ××•×’×“×¨×™×
   - Redis (×¨×§ ×œ×©×œ×‘ 4 - Hold)

3. **×§×‘×¦×™ Batch:**
   - ×›×œ ×§×‘×¦×™ ×”-`.bat` ×”× wrappers ×œ-Python scripts
   - ×”× ×¤×©×•×˜ ×§×•×¨××™× ×œ-Python script ×”××ª××™×
   - ××¤×©×¨ ×œ×”×¨×™×¥ ×™×©×™×¨×•×ª ××ª ×”-Python scripts

