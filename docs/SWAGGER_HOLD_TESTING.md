# ××“×¨×™×š ×‘×“×™×§×ª Hold ×“×¨×š Swagger - ×©×œ×‘ ××—×¨ ×©×œ×‘

## ğŸ“‹ ×”×›× ×”

1. **×¤×ª×— Swagger UI:**
   ```
   http://127.0.0.1:8000/docs
   ```

2. **×•×“× ×©×”×©×¨×ª ×¨×¥:**
   ```bash
   python -m uvicorn src.api_server:app --reload
   ```

---

## ğŸ” ×©×œ×‘ 0: ×‘×“×™×§×ª ×¦×™××¨×™× ×–××™× ×™×

### 1. ×¤×ª×—: `GET /cabins`

**×œ×—×¥:** "Try it out" â†’ "Execute"

**××” ×¦×¨×™×š ×œ×¨××•×ª:**
```json
[
  {
    "cabin_id": "...",
    "name": "×”×¦×™××¨ ×©×œ...",
    "cabin_id_string": "ZB01" ××• "ZN01" ×•×›×•'
  }
]
```

**ğŸ“ ×¨×©×•× ×œ×¢×¦××š:**
- ××™×–×” `cabin_id_string` ×™×© (ZB01, ZB02, ZN01, ×•×›×•')
- ××™×–×” `name` ×™×© ×œ×›×œ ×¦×™××¨

**ğŸ’¡ ×—×©×•×‘:** ×”×©×ª××© ×‘-`cabin_id_string` (ZB01) ×•×œ× ×‘-UUID!

---

## ğŸ”’ ×©×œ×‘ 1: ×™×¦×™×¨×ª Hold

### 1. ×¤×ª×—: `POST /hold`

### 2. ×œ×—×¥: "Try it out"

### 3. ×”×–×Ÿ JSON (×”×—×œ×£ ××ª ×”×¢×¨×›×™×):

```json
{
  "cabin_id": "ZB01",
  "check_in": "2026-01-10 15:00",
  "check_out": "2026-01-12 11:00",
  "customer_name": "×™×©×¨××œ ×™×©×¨××œ×™ - ×‘×“×™×§×”"
}
```

**ğŸ“ ×”×¢×¨×•×ª:**
- `cabin_id`: ×”×©×ª××© ×‘-`cabin_id_string` ××”×©×œ×‘ ×”×§×•×“× (ZB01, ZB02, ×•×›×•')
- `check_in`: ×ª××¨×™×š ×‘×¢×ª×™×“ (×œ×¤×—×•×ª ××—×¨)
- `check_out`: ×ª××¨×™×š ××—×¨×™ check_in
- `customer_name`: ×›×œ ×©× ×©×ª×¨×¦×”

### 4. ×œ×—×¥: "Execute"

### 5. ××” ×¦×¨×™×š ×œ×§×‘×œ:

**âœ… ×”×¦×œ×—×” (200):**
```json
{
  "hold_id": "abc-123-def-456",
  "cabin_id": "ZB01",
  "check_in": "2026-01-10 15:00",
  "check_out": "2026-01-12 11:00",
  "expires_at": "2026-01-10T15:15:00",
  "status": "active",
  "message": "Hold created successfully",
  "warning": null
}
```

**âŒ ×©×’×™××” ××¤×©×¨×™×ª:**
- `404`: "Cabin not found" â†’ ×‘×“×•×§ ××ª `cabin_id` (×”×©×ª××© ×‘-ZB01 ×•×œ× UUID)
- `409`: "Cabin is not available" â†’ ×”×¦×™××¨ ×ª×¤×•×¡ ×‘×ª××¨×™×›×™× ×”××œ×”
- `500`: ×©×’×™××ª ×©×¨×ª â†’ ×‘×“×•×§ ××ª ×”×œ×•×’×™×

### 6. ğŸ“ ×¨×©×•× ×œ×¢×¦××š:
- **`hold_id`** - ×ª×¦×˜×¨×š ××•×ª×• ×œ×©×œ×‘×™× ×”×‘××™×!

---

## ğŸ” ×©×œ×‘ 2: ×‘×“×™×§×ª ×¡×˜×˜×•×¡ Hold

### 1. ×¤×ª×—: `GET /hold/{hold_id}`

### 2. ×œ×—×¥: "Try it out"

### 3. ×”×–×Ÿ:
- `hold_id`: ×”×¢×ª×§ ××ª ×”-`hold_id` ××”×©×œ×‘ ×”×§×•×“×

### 4. ×œ×—×¥: "Execute"

### 5. ××” ×¦×¨×™×š ×œ×§×‘×œ:

**âœ… ×”×¦×œ×—×” (200):**
```json
{
  "hold_id": "abc-123-def-456",
  "cabin_id": "ZB01",
  "check_in": "2026-01-10",
  "check_out": "2026-01-12",
  "expires_at": "2026-01-10T15:15:00",
  "status": "active",
  "customer_name": "×™×©×¨××œ ×™×©×¨××œ×™ - ×‘×“×™×§×”",
  "customer_id": null,
  "created_at": "2026-01-10T15:00:00"
}
```

**âŒ ×©×’×™××”:**
- `404`: "Hold not found or expired" â†’ Hold ×œ× ×§×™×™× ××• ×¤×’ ×ª×•×§×£

### 6. âœ… ×‘×“×•×§:
- `status` = "active"
- `expires_at` = ×‘×¢×•×“ 15 ×“×§×•×ª ××”×–××Ÿ ×”× ×•×›×—×™
- `cabin_id` = ×”×¦×™××¨ ×©×‘×—×¨×ª

---

## ğŸš« ×©×œ×‘ 3: ×× ×™×¢×ª Hold ×›×¤×•×œ

### 1. ×¤×ª×— ×©×•×‘: `POST /hold`

### 2. ×œ×—×¥: "Try it out"

### 3. ×”×–×Ÿ **××•×ª×• JSON** ×›××• ×‘×©×œ×‘ 1:
```json
{
  "cabin_id": "ZB01",
  "check_in": "2026-01-10 15:00",
  "check_out": "2026-01-12 11:00",
  "customer_name": "×œ×§×•×— ××—×¨ - ×‘×“×™×§×”"
}
```

**ğŸ“ ×—×©×•×‘:** ××•×ª× `cabin_id`, `check_in`, `check_out`!

### 4. ×œ×—×¥: "Execute"

### 5. ××” ×¦×¨×™×š ×œ×§×‘×œ:

**âœ… ×”×¦×œ×—×” (×›×¦×¤×•×™ - ×©×’×™××”!):**
```json
{
  "detail": "Cabin ZB01 is already on hold until 2026-01-10T15:15:00"
}
```

**×§×•×“ ×¡×˜×˜×•×¡:** `400` ××• `409`

**ğŸ’¡ ×–×” ××•××¨:** ×”××¢×¨×›×ª ××•× ×¢×ª Hold ×›×¤×•×œ! âœ…

---

## ğŸ“… ×©×œ×‘ 4: ×”××¨×” ×œ×”×–×× ×” (Convert Hold to Booking)

### 1. ×¤×ª×—: `POST /book`

### 2. ×œ×—×¥: "Try it out"

### 3. ×”×–×Ÿ JSON (×”×—×œ×£ ××ª ×”×¢×¨×›×™×):

```json
{
  "cabin_id": "ZB01",
  "check_in": "2026-01-10 15:00",
  "check_out": "2026-01-12 11:00",
  "customer": "×™×©×¨××œ ×™×©×¨××œ×™ - ×‘×“×™×§×”",
  "phone": "050-1234567",
  "email": "test@example.com",
  "adults": 2,
  "kids": 0,
  "total_price": 1000.0,
  "hold_id": "abc-123-def-456",
  "notes": "×‘×“×™×§×” ×©×œ ×©×œ×‘ 4"
}
```

**ğŸ“ ×”×¢×¨×•×ª:**
- `hold_id`: ×”×¢×ª×§ ××ª ×”-`hold_id` ××”×©×œ×‘ 1
- `cabin_id`, `check_in`, `check_out`: **×—×™×™×‘×™× ×œ×”×™×•×ª ×–×”×™×** ×œ-Hold!
- `total_price`: ×›×œ ×¡×›×•× (1000.0)

### 4. ×œ×—×¥: "Execute"

### 5. ××” ×¦×¨×™×š ×œ×§×‘×œ:

**âœ… ×”×¦×œ×—×” (200):**
```json
{
  "success": true,
  "cabin_id": "ZB01",
  "event_id": "calendar-event-id-here",
  "event_link": "https://calendar.google.com/calendar/event?eid=...",
  "message": "Booking created successfully"
}
```

### 6. âœ… ×‘×“×•×§:
- `success` = true
- `event_id` = ×§×™×™× (××–×”×” ××™×¨×•×¢ ×‘-Calendar)
- `event_link` = ×§×™×©×•×¨ ×œ-Google Calendar

### 7. ğŸ” ×‘×“×•×§ ×©×”-Hold × ××—×§:

**×—×–×•×¨ ×œ×©×œ×‘ 2** (`GET /hold/{hold_id}`) ×¢× ××•×ª×• `hold_id`:

**××” ×¦×¨×™×š ×œ×§×‘×œ:**
```json
{
  "detail": "Hold not found or expired"
}
```

**×§×•×“ ×¡×˜×˜×•×¡:** `404`

**ğŸ’¡ ×–×” ××•××¨:** Hold ×”×•××¨ ×œ×”×–×× ×” ×•× ××—×§! âœ…

---

## ğŸ—‘ï¸ ×©×œ×‘ 5: ×‘×™×˜×•×œ Hold ×™×“× ×™

### 1. ×¦×•×¨ Hold ×—×“×© (×›××• ×‘×©×œ×‘ 1)

**ğŸ“ ×¨×©×•× ××ª ×”-`hold_id` ×”×—×“×©!**

### 2. ×¤×ª×—: `DELETE /hold/{hold_id}`

### 3. ×œ×—×¥: "Try it out"

### 4. ×”×–×Ÿ:
- `hold_id`: ×”×¢×ª×§ ××ª ×”-`hold_id` ×”×—×“×©

### 5. ×œ×—×¥: "Execute"

### 6. ××” ×¦×¨×™×š ×œ×§×‘×œ:

**âœ… ×”×¦×œ×—×” (200):**
```json
{
  "success": true,
  "message": "Hold released successfully",
  "hold_id": "abc-123-def-456"
}
```

### 7. ğŸ” ×‘×“×•×§ ×©×”-Hold × ××—×§:

**×—×–×•×¨ ×œ×©×œ×‘ 2** (`GET /hold/{hold_id}`):

**××” ×¦×¨×™×š ×œ×§×‘×œ:**
```json
{
  "detail": "Hold not found or expired"
}
```

**ğŸ’¡ ×–×” ××•××¨:** Hold ×‘×•×˜×œ ×‘×”×¦×œ×—×”! âœ…

---

## ğŸ“Š ××™×¤×” ×œ×¨××•×ª ××ª ×”×ª×•×¦××•×ª?

### 1. Google Calendar

1. ×¤×ª×—: https://calendar.google.com
2. ××¦× ××ª ×™×•××Ÿ ×”×¦×™××¨ (×œ××©×œ: "Cabin ZB01 - ×”×¦×™××¨ ×©×œ...")
3. ×—×¤×© ××™×¨×•×¢×™×:
   - **Hold:** ××™×¨×•×¢ ×¦×”×•×‘ ×¢× "ğŸ”’ HOLD | ×©× ×œ×§×•×—"
   - **×”×–×× ×”:** ××™×¨×•×¢ ×™×¨×•×§ ×¢× "×”×–×× ×” | ×©× ×œ×§×•×—"

### 2. Database

**×¤×ª×— psql:**
```bash
psql -U postgres -d zimmerbot_db
```

**×‘×“×•×§ ×”×–×× ×•×ª:**
```sql
SELECT * FROM bookings ORDER BY created_at DESC LIMIT 5;
```

**×‘×“×•×§ ×œ×§×•×—×•×ª:**
```sql
SELECT * FROM customers ORDER BY created_at DESC LIMIT 5;
```

**×‘×“×•×§ Transactions:**
```sql
SELECT * FROM transactions ORDER BY created_at DESC LIMIT 5;
```

### 3. Redis (×× ××•×ª×§×Ÿ)

```bash
redis-cli

# ×¨×©×™××ª ×›×œ ×”-Holds
KEYS "hold:*"

# ×¤×¨×˜×™ Hold
GET "hold:ZB01:2026-01-10:2026-01-12"

# ×›××” ×–××Ÿ × ×©××¨ (TTL)
TTL "hold:ZB01:2026-01-10:2026-01-12"
```

---

## â° ×ª×–××•×Ÿ Hold (15 ×“×§×•×ª)

### ××™×š ×œ×‘×“×•×§ Hold ××ª×¤×•×’×’ ××•×˜×•××˜×™×ª:

1. **×¦×•×¨ Hold** (×©×œ×‘ 1)
2. **×¨×©×•× ××ª ×”-`expires_at`**
3. **×—×›×” 15 ×“×§×•×ª** (××• ×©× ×” `HOLD_DURATION_SECONDS` ×‘-`.env` ×œ-60 ×©× ×™×•×ª ×œ×‘×“×™×§×” ××”×™×¨×”)
4. **×‘×“×•×§ ×©×•×‘** (`GET /hold/{hold_id}`)

**××” ×¦×¨×™×š ×œ×§×‘×œ ××—×¨×™ 15 ×“×§×•×ª:**
```json
{
  "detail": "Hold not found or expired"
}
```

**ğŸ’¡ ×–×” ××•××¨:** Hold ×”×ª×¤×•×’×’ ××•×˜×•××˜×™×ª! âœ…

---

## ğŸ› ×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª

### ×©×’×™××”: "Cabin not found"

**×¡×™×‘×•×ª ××¤×©×¨×™×•×ª:**
- ×”×©×ª××©×ª ×‘-UUID ×‘××§×•× ×‘-`cabin_id_string` (ZB01)
- ×”×¦×™××¨ ×œ× ×§×™×™× ×‘××¢×¨×›×ª

**×¤×ª×¨×•×Ÿ:**
1. ×‘×“×•×§ `GET /cabins` - ××™×–×” `cabin_id_string` ×™×©
2. ×”×©×ª××© ×‘-`cabin_id_string` (ZB01, ZB02, ×•×›×•')

### ×©×’×™××”: "Cabin is not available"

**×¡×™×‘×•×ª ××¤×©×¨×™×•×ª:**
- ×”×¦×™××¨ ×ª×¤×•×¡ ×‘×ª××¨×™×›×™× ×”××œ×”
- ×™×© ××™×¨×•×¢ ×‘-Calendar ×‘×ª××¨×™×›×™× ×”××œ×”

**×¤×ª×¨×•×Ÿ:**
1. ×‘×—×¨ ×ª××¨×™×›×™× ××—×¨×™×
2. ××• ×‘×“×•×§ ×‘-Calendar ××” ×™×© ×‘×ª××¨×™×›×™× ×”××œ×”

### Hold ×œ× ××ª×¤×•×’×’

**×¡×™×‘×•×ª ××¤×©×¨×™×•×ª:**
- Redis ×œ× ×¤×¢×™×œ (Hold ×œ× ××•×’×Ÿ)
- TTL ×œ× ×¢×•×‘×“

**×¤×ª×¨×•×Ÿ:**
1. ×”×ª×§×Ÿ ×•×”×¤×¢×œ Redis
2. ×‘×“×•×§ `redis-cli TTL "hold:..."`

---

## âœ… ×¡×™×›×•× - ××” ×‘×“×§× ×•?

- [x] ×™×¦×™×¨×ª Hold
- [x] ×‘×“×™×§×ª ×¡×˜×˜×•×¡ Hold
- [x] ×× ×™×¢×ª Hold ×›×¤×•×œ
- [x] ×”××¨×” ×œ×”×–×× ×”
- [x] ×‘×™×˜×•×œ Hold ×™×“× ×™
- [x] Hold ××ª×¤×•×’×’ ××•×˜×•××˜×™×ª (15 ×“×§×•×ª)

**ğŸ‰ ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×•? ×©×œ×‘ 4 ××•×›×Ÿ!**

