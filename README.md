# 🏡 מערכת הזמנות אוטומטית לצימרים
### סוכן AI חכם עם שליטה מלאה - מקצה לקצה

<div align="center">

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![Status](https://img.shields.io/badge/status-in_development-yellow.svg)
![License](https://img.shields.io/badge/license-MIT-green.svg)

**מערכת הזמנות מתקדמת ואינטליגנטית לצימרים שמטפלת בכל התהליך באופן אוטומטי**

[תכונות](#-תכונות-ליבה) • [ארכיטקטורה](#️-ארכיטקטורה-טכנית) • [התחלה מהירה](#-התחלה-מהירה) • [תוכנית בנייה](#-תוכנית-בנייה-שלב-אחר-שלב)

</div>

---

## 📋 תוכן עניינים

- [סקירה כללית](#-סקירה-כללית)
- [ערך מוסף](#-ערך-מוסף)
- [מדדי הצלחה (KPI)](#-מדדי-הצלחה-kpi)
- [יכולות המערכת](#️-יכולות-המערכת)
- [ארכיטקטורה טכנית](#️-ארכיטקטורה-טכנית)
- [סטק טכנולוגי](#-סטק-טכנולוגי)
- [תוכנית בנייה שלב אחר שלב](#-תוכנית-בנייה-שלב-אחר-שלב)
- [אבני דרך והגדרות הצלחה](#-אבני-דרך-והגדרות-הצלחה)
- [התחלה מהירה](#-התחלה-מהירה)
- [תובנות קריטיות](#-תובנות-קריטיות)
- [מצב פרויקט](#-מצב-פרויקט-והצעד-הבא)

---

## 🧠 Model

## 💎 ערך מוסף

### ללקוח (האורח)

| ✅ יתרון | 📊 השפעה |
|---------|----------|
| **תשובה מיידית בכל שעה** | זמינות 24/7 ללא המתנה |
| **תהליך הזמנה פשוט ומהיר** | חווית משתמש משופרת |
| **מידע מלא במקום אחד** | תמונות, תיאורים, תשלום |
| **שקיפות מלאה במחירים** | אין הפתעות לא נעימות |

### לבעל הצימר

| ✅ יתרון | 💰 תועלת עסקית |
|---------|----------------|
| **הפחתת שיחות חוזרות** | חיסכון בזמן ומשאבים |
| **מניעת טעויות בזמינות** | אפס דאבל בוקינג |
| **הגדלת הזמנות ישירות** | הכנסה גבוהה יותר |
| **מכירת תוספות וחבילות** | הגדלת ערך עסקה ממוצע (AOV) |
| **אוטומציה מלאה** | פחות עבודה ידנית, יותר בקרה |

---

## 📈 מדדי הצלחה (KPI)

### 🤖 אוטומציה ויעילות

**שיעור אוטומציה = (פניות שנסגרו אוטומטית / כל הפניות) × 100%**  
🎯 **יעד: > 80%**

| מדד | הגדרה | יעד |
|-----|-------|-----|
| **שיעור אוטומציה** | אחוז הפניות שנסגרו ללא התערבות אנושית | > 80% |
| **ירידה בשיחות חוזרות** | השוואה לפני ואחרי המערכת | -50% לפחות |
| **זמן תגובה ממוצע** | זמן תגובה ממוצע לפנייה | < 30 שניות |

### 💰 הכנסות והמרה

| מדד | הגדרה | יעד |
|-----|-------|-----|
| **הזמנות ישירות** | כמות והכנסה מהזמנות דרך המערכת | +30% לפחות |
| **שיעור המרה** | (הזמנות / חיפושים) × 100% | > 15% |
| **הכנסה מתוספות** | הכנסה נוספת מתוספות וחבילות | +20% מהכנסות |

### 😊 שביעות רצון

**ציון שביעות רצון (NPS) = אחוז ממליצים - אחוז מתנגדים**  
🎯 **יעד: > 50**

| מדד | איסוף | יעד |
|-----|--------|-----|
| **שביעות רצון אורח** | סקר אחרי שהות | ציון > 4.5/5 |
| **Net Promoter Score** | שאלה "האם תמליץ?" | NPS > 50 |

---

## 🎖️ אבני דרך והגדרות הצלחה

| אבן דרך | תיאור | סטטוס |
|---------|--------|-------|
| **🏗️ MVP** | מערכת בסיסית עם צ'אט + יומן + תשלום | 🟡 בביצוע |
| **🚀 Beta** | הוספת טלפון + דשבורד + הודעות | ⚪ ממתין |
| **✅ Production** | מערכת מלאה ויציבה עם כל התכונות | ⚪ ממתין |
| **📈 Scale** | אופטימיזציה וביצועים | ⚪ ממתין |

---

## 💡 תובנות קריטיות

### ✅ עשה

- **התחל פשוט** - MVP קודם, תכונות מתקדמות אחר כך
- **בדוק כל שלב** - אל תמשיך לפני שהשלב הנוכחי עובד
- **תעד הכל** - תיעוד טוב חוסך זמן בהמשך
- **חשוב על סקיילביליות** - תכנן מראש לגדילה
- **אבטחה מהיום הראשון** - אל תדחה לאחר כך

### ❌ אל תעשה

- **אל תדלג על שלבים** - זה יחזור לנגוס בך
- **אל תזלזל בטסטים** - טסטים = ביטחון
- **אל תתחיל עם over-engineering** - YAGNI
- **אל תשכח backups** - נתונים = זהב
- **אל תעבוד בלי version control** - Git הוא חובה

---

## 🖥️ View

## 🎯 סקירה כללית

### מה אנחנו בונים?

מערכת הזמנות מתקדמת ואינטליגנטית לצימרים שמטפלת בכל התהליך מקצה לקצה - מהרגע שהאורח פונה ועד לאחר השהות.

### 🎨 תכונות ליבה

| תכונה | תיאור |
|-------|--------|
| 💬 **צ'אט באתר** | ממשק שיחה אינטראקטיבי באתר האינטרנט |
| 📞 **סוכן קולי טלפוני** | שירות אוטומטי 24/7 לטיפול בשיחות |
| 🔍 **חיפוש וסינון חכם** | בדיקת זמינות מתקדמת עם פילטרים מרובים |
| 📅 **ניהול יומן ושריון** | מניעת דאבל בוקינג באמצעות מערכת Hold |
| 💰 **תמחור דינמי** | תמחור גמיש לפי עונות, סופ"ש וחגים |
| 💳 **תשלומים מאובטחים** | אינטגרציה מלאה עם ספקי סליקה + אימות |
| 📨 **הודעות אוטומטיות** | תזכורות והודעות ממוכנות ללקוחות ולבעלים |
| 🚨 **התראות חכמות** | התראות בזמן אמת על שינויים וחריגות |

### 🔑 עיקרון מפתח

```
┌─────────────────────────────────────────────────┐
│  הממשקים (צ'אט, טלפון) = שכבה דקה              │
│                                                 │
│  כל השכל + החוקים + הנתונים = Backend + DB    │
└─────────────────────────────────────────────────┘
```

**הכל מרוכז בשרת ובמסד הנתונים - הממשקים רק מציגים ומעבירים מידע.**

---

## 🛠️ יכולות המערכת

### 1️⃣ ערוצים וממשקים

```
┌──────────────┐
│ צ'אט באתר    │ ← עיקרי
├──────────────┤
│ טלפון קולי   │ ← עיקרי
├──────────────┤
│ WhatsApp     │ ← אופציונלי
├──────────────┤
│ העברה לאדם   │ ← במקרים מורכבים
└──────────────┘
```

**מתי מעבירים לאדם?**
- מקרים מורכבים שדורשים החלטה אנושית
- בעיות טכניות או תלונות
- בקשות מיוחדות שאינן סטנדרטיות
- שעות פעילות סבירות בלבד

### 2️⃣ חיפוש וסינון מתקדם

#### קלט מהאורח

```yaml
פרמטרי חיפוש:
  תאריכים:
    - תאריך התחלה
    - תאריך סיום
    - גמישות בתאריכים (±1-3 ימים)
  
  אנשים:
    - מספר מבוגרים (נדרש)
    - מספר ילדים (אופציונלי)
    - גילאי ילדים (לצרכי תמחור)
  
  מיקום:
    - אזור גיאוגרפי
    - מרחק ממרכז עיר
    - קרבה לאטרקציות
  
  תקציב:
    - מחיר מינימום
    - מחיר מקסימום
    - כולל/לא כולל תוספות
  
  מאפיינים:
    - בריכה (פרטית/משותפת)
    - ג'קוזי
    - ארוחת בוקר
    - חניה
    - נגישות לנכים
    - ידידותי לחיות מחמד
```

#### פלט לאורח

```
┌────────────────────────────────────────┐
│ תוצאה 1: צימר רומנטי בגליל            │
│ ────────────────────────────────────   │
│ 💰 מחיר: ₪800/לילה                    │
│ 📷 3 תמונות                           │
│ ✨ בריכה פרטית, ג'קוזי, נוף          │
│ 📍 מרחק: 2 ק"מ ממרכז העיר            │
│                                        │
│ [הצג פרטים] [הזמן עכשיו]              │
└────────────────────────────────────────┘
```

**תכונות חיפוש:**
- המלצה על 2-3 אופציות מתאימות ביותר
- מחיר ברור וסופי (כולל מסים)
- גלריית תמונות איכותית
- תיאור תמציתי ומדויק
- אפשרות לשאול שאלות על כל אופציה
- השוואה בין אופציות

### 3️⃣ זמינות ושריון

#### מנגנון מניעת דאבל בוקינג

```
תרשים זרימה:
    אורח → בדיקת זמינות → יומן
    יומן → צימרים פנויים → מערכת
    מערכת → הצגת אופציות → אורח
    
    אורח → בחירת צימר → מערכת
    מערכת → יצירת Hold (10-20 דק') → יומן + DB
    מערכת → Hold אקטיבי → אורח
    
    אורח → ביצוע תשלום → מערכת
    מערכת → אימות תשלום → DB
    מערכת → הזמנה סופית → יומן
    מערכת → אישור הזמנה → אורח
```

#### שלבי תהליך ההזמנה

| שלב | פעולה | משך זמן | מצב |
|-----|-------|---------|-----|
| **1** | בדיקת זמינות | רגעי | זמין/תפוס |
| **2** | Hold זמני | 10-20 דקות | שמור זמנית |
| **3** | תשלום | עד 20 דקות | בהמתנה לתשלום |
| **4** | אישור סופי | רגעי | מאושר ונעול |

**תכונות נוספות:**
- ✅ בדיקת זמינות בזמן אמת - חיבור ישיר ליומן
- 🔒 Hold זמני - נעילה של 10-20 דקות למניעת דאבל בוקינג
- ⏱️ ניהול תפוגה - שחרור אוטומטי של Hold שתפג
- 💳 נעילה אחרי תשלום - הזמנה נסגרת רק אחרי אישור תשלום
- 🔄 שינוי תאריכים - אפשרות לשינוי לפי מדיניות
- ❌ ביטולים - טיפול בביטולים לפי מדיניות החזרים

### 4️⃣ תמחור ותוספות

#### מנגנון תמחור דינמי

```python
# דוגמה לחישוב מחיר
def calculate_price(cabin, dates, guests, addons):
    base_price = cabin.base_price
    
    # התאמות לפי תאריך
    if is_weekend(dates):
        base_price *= 1.3  # +30% לסופ"ש
    if is_holiday(dates):
        base_price *= 1.5  # +50% לחג
    if is_high_season(dates):
        base_price *= 1.2  # +20% לעונה גבוהה
    
    # תוספות אופציונליות
    for addon in addons:
        base_price += addon.price
    
    # מספר לילות
    nights = calculate_nights(dates)
    total = base_price * nights
    
    # הנחות
    if nights >= 7:
        total *= 0.9  # -10% לשבוע
    
    return total
```

#### סוגי תמחור

| גורם | השפעה | דוגמה |
|------|-------|--------|
| **יום בשבוע** | ×1.0 - ×1.3 | סופ"ש +30% |
| **עונה** | ×1.0 - ×1.5 | קיץ +20%, חגים +50% |
| **משך שהות** | -0% עד -15% | שבוע -10%, חודש -15% |
| **התראה מוקדמת** | -0% עד -20% | הזמנה מראש -20% |

#### תוספות זמינות

```
📋 תוספות בסיסיות:
├── ארוחת בוקר: ₪50 לאדם
├── צ'ק אין מוקדם: ₪100
├── צ'ק אאוט מאוחר: ₪150
├── חדר נוסף: ₪200 ללילה
└── חניה מאובטחת: ₪50 ללילה

🎁 חבילות מיוחדות:
├── רומנטית: לינה + ארוחה + יין + פרחים (₪500)
├── משפחתית: לינה + כניסה לפארק + ארוחת צהריים (₪800)
└── ספא: לינה + טיפול + בריכה מחוממת (₪700)

🎟️ קופונים והנחות:
├── קוד קופון: הנחה של X%
├── לקוח חוזר: -10%
└── הזמנה מוקדמת: -20%
```

### 5️⃣ מערכת תשלומים

#### זרימת תהליך התשלום

```
אורח בוחר צימר
        ↓
מערכת מייצרת חיוב
        ↓
שליחת קישור תשלום / תשלום בתהליך
        ↓
אורח משלם
        ↓
Webhook מספק הסליקה ← אימות תשלום
        ↓
עדכון סטטוס ב-DB
        ↓
נעילת הזמנה ביומן
        ↓
שליחת קבלה + אישור
```

#### תכונות מערכת התשלומים

| תכונה | תיאור |
|-------|--------|
| 💳 **יצירת חיוב** | חיוב מאובטח עם פרטי ההזמנה |
| 🔗 **קישור תשלום** | שליחת קישור נוח למייל/SMS |
| ✅ **אימות Webhook** | אימות אוטומטי של התשלום |
| 🧾 **קבלות** | הפקת קבלה מס אוטומטית |
| 📊 **סטטוס** | מעקב אחר סטטוס התשלום |
| 💸 **החזרים** | ניהול החזרים לפי מדיניות |
| 🔒 **אבטחה** | תקן PCI DSS |

**ספקי סליקה נתמכים:**
- **בינלאומי:** Stripe, PayPal
- **ישראלי:** Tranzila, Cardcom, Yaad Sarig
- אפשרות להוספת ספקים נוספים

### 6️⃣ הודעות אוטומטיות ותזכורות

#### הודעות לאורח

```
מסע ההודעות ללקוח:
════════════════════════════════════════

📧 אישור הזמנה (מיידי)
   └─ פרטי הזמנה מלאים
   └─ קבלה ומספר הזמנה
   └─ מדיניות ביטול

⏰ תזכורת לפני הגעה (3 ימים)
   └─ תזכורת ידידותית
   └─ פרטי קשר של הצימר
   └─ המלצות לאזור

🗺️ הוראות הגעה (יום ההגעה)
   └─ קישור Waze/Google Maps
   └─ הוראות חניה
   └─ פרטי כניסה ומפתחות

🌟 הודעת תודה (אחרי השהות)
   └─ תודה על הביקור
   └─ בקשה לביקורת
   └─ קופון להזמנה הבאה
```

#### הודעות לבעל הצימר

```
מערכת ניהול התראות:
══════════════════════════════════════

🔔 הזמנה חדשה (מיידי)
   └─ פרטי האורח
   └─ תאריכים וסכום
   └─ בקשות מיוחדות

⚠️ ביטול או שינוי (מיידי)
   └─ עדכון על שינוי
   └─ פרטי הביטול/שינוי
   └─ סטטוס החזר כספי

🏠 תזכורת הכנה (יום לפני)
   └─ תזכורת להכין צימר
   └─ רשימת משימות
   └─ פרטי האורח הבא

📊 דוחות ותובנות (שבועי)
   └─ תפוסה
   └─ הכנסות
   └─ ממוצע ביקורות
   └─ התראות על מגמות
```

#### ערוצי שליחה

- 📧 **אימייל** - הודעות מפורטות
- 📱 **SMS** - עדכונים קצרים וחשובים
- 💬 **WhatsApp** - אופציונלי, לתקשורת אינטראקטיבית
- 🔔 **Push Notifications** - באפליקציה/דשבורד

### 7️⃣ ניהול ובקרה

#### דשבורד ניהול מרכזי

```
╔═══════════════════════════════════════════╗
║          דשבורד בעל הצימר                ║
╠═══════════════════════════════════════════╣
║                                           ║
║  📊 סטטיסטיקות היום                      ║
║  ├─ הזמנות חדשות: 3                      ║
║  ├─ הכנסות: ₪2,400                       ║
║  └─ תפוסה: 85%                           ║
║                                           ║
║  📅 הזמנות קרובות                        ║
║  ├─ הגעה היום: 2 צימרים                  ║
║  ├─ יציאה היום: 1 צימר                   ║
║  └─ Hold פעיל: 0                         ║
║                                           ║
║  🎯 KPI חודשי                             ║
║  ├─ תפוסה: 78% (↑5%)                     ║
║  ├─ הכנסות: ₪68,000 (↑12%)               ║
║  ├─ ביקורות: 4.8/5 (↑0.2)                ║
║  └─ שיעור ביטול: 3% (↓2%)                ║
║                                           ║
╚═══════════════════════════════════════════╝
```

#### תכונות ניהול

| תכונה | תיאור |
|-------|--------|
| 📋 **ניהול הזמנות** | צפייה, עריכה וביטול הזמנות |
| 📅 **תצוגת לוח שנה** | ויזואליזציה של תפוסה |
| 💰 **דוחות כספיים** | דוחות הכנסות והוצאות |
| 📊 **ניתוח KPI** | מעקב אחר מדדי ביצועים |
| 🔍 **לוג פעולות** | מי עשה מה ומתי |
| 👥 **ניהול משתמשים** | הרשאות ותפקידים |
| 📈 **תחזיות** | תחזית תפוסה והכנסות |

#### הרשאות משתמשים

```yaml
תפקידים במערכת:
  
  בעלים (Owner):
    - גישה מלאה לכל המערכת
    - ניהול משתמשים והרשאות
    - עריכת הגדרות ותמחור
    - צפייה בכל הדוחות
  
  מנהל (Manager):
    - ניהול הזמנות
    - עדכון זמינות
    - תקשורת עם לקוחות
    - צפייה ברוב הדוחות
  
  נציג (Agent):
    - צפייה בהזמנות
    - תקשורת בסיסית
    - עדכון סטטוסים
    - דוחות מוגבלים
  
  מנקה (Cleaner):
    - רשימת משימות ניקיון
    - עדכון סטטוס נקי/לא נקי
    - הודעות על בעיות
```

---

## 🎛️ Controller

## 🏗️ ארכיטקטורה טכנית

### סקירת שכבות המערכת

```
┌─────────────────────────────────────────────────┐
│              CHANNELS (ערוצים)                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐      │
│  │   צ'אט   │  │  טלפון   │  │ WhatsApp │      │
│  │  באתר    │  │   קולי   │  │(optional)│      │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘      │
└───────┼─────────────┼─────────────┼────────────┘
        │             │             │
        └─────────────┴─────────────┘
                      │
┌─────────────────────▼─────────────────────────┐
│            BACKEND (שרת יישומים)              │
│  ┌────────────────────────────────────────┐   │
│  │  ▸ לוגיקה עסקית                       │   │
│  │  ▸ ניהול הזמנות                       │   │
│  │  ▸ בדיקת זמינות                       │   │
│  │  ▸ חישוב מחירים                       │   │
│  │  ▸ ניהול תשלומים                      │   │
│  └────────────────────────────────────────┘   │
└───────┬───────┬───────┬───────┬──────┬────────┘
        │       │       │       │      │
   ┌────▼──┐ ┌──▼──┐ ┌──▼──┐ ┌──▼──┐ ┌▼─────┐
   │  DB   │ │ CAL │ │REDIS│ │ PAY │ │NOTIFY│
   │       │ │     │ │     │ │     │ │      │
   │Postgres│ │G.Cal│ │Cache│ │Stripe│ │Email│
   └───────┘ └─────┘ └─────┘ └─────┘ └──────┘
```

### רכיבי המערכת

#### 1. Channels (ערוצים)
- **צ'אט באתר** - ממשק Web בזמן אמת
- **טלפון** - סוכן קולי IVR
- **WhatsApp** - אופציונלי, API עסקי

#### 2. Backend (שרת יישומים)
- **API Server** - REST/GraphQL endpoints
- **Business Logic** - כללי עסק ותהליכים
- **Integration Layer** - חיבור לשירותים חיצוניים

#### 3. Database (מסד נתונים)
- **Cabins** - מידע על צימרים
- **Bookings** - הזמנות ושריונים
- **Customers** - פרטי לקוחות
- **Prices** - תמחור ומבצעים
- **Transactions** - תשלומים

#### 4. Calendar (יומן)
- **Google Calendar** - יומן נפרד לכל צימר
- **Availability** - מקור אמת לזמינות
- **Events** - הזמנות בפועל

#### 5. Redis (Cache & Locks)
- **Hold Management** - נעילות זמניות
- **Session Storage** - סשנים פעילים
- **Rate Limiting** - הגבלת קצב

#### 6. Payments (תשלומים)
- **Payment Gateway** - Stripe/Tranzila
- **Webhooks** - אימות תשלומים
- **Refunds** - החזרים

#### 7. Notifications (התראות)
- **Email** - SendGrid/AWS SES
- **SMS** - Twilio/Infobip
- **Queue** - תור הודעות אסינכרוני

### זרימת עבודה בסיסית

```
אורח נכנס לצ'אט/טלפון
          │
          ▼
    Backend מקבל בקשה
          │
          ▼
    בדיקת זמינות ביומן + DB
          │
          ▼
    חישוב מחירים (Pricing Engine)
          │
          ▼
    החזרת 2-3 אופציות לאורח
          │
          ▼
    אורח בוחר צימר
          │
          ▼
    Hold זמני ב-Redis + Calendar
          │
          ▼
    אורח מבצע תשלום
          │
          ▼
    Webhook מאשר תשלום
          │
          ▼
    נעילה סופית ב-DB + Calendar
          │
          ▼
    שליחת הודעות אישור
```

---

## 💻 סטק טכנולוגי

### Backend Framework

#### אופציה 1: FastAPI (Python) ⭐ מומלץ

```python
✅ יתרונות:
  - מהיר ואסינכרוני
  - TypeHinting מובנה
  - תיעוד API אוטומטי
  - קל ללמידה
  - אקוסיסטם עשיר

📦 Stack מומלץ:
  - FastAPI + Pydantic
  - SQLAlchemy (ORM)
  - Celery (Tasks)
  - Redis (Cache)
```

#### אופציה 2: Node.js + NestJS

```javascript
✅ יתרונות:
  - אקוסיסטם ענק (npm)
  - ביצועים מצוינים
  - קהילה גדולה
  - TypeScript support

📦 Stack מומלץ:
  - NestJS + TypeORM
  - BullMQ (Tasks)
  - Redis (Cache)
```

### מסד נתונים

#### PostgreSQL 15+ ⭐ מומלץ

```sql
✅ למה PostgreSQL?
  ✓ יציב ומהימן
  ✓ תמיכה ב-JSONB
  ✓ Transactions חזקים
  ✓ Full-text search
  ✓ קהילה ותמיכה מצוינת
  ✓ חינמי לחלוטין

טבלאות עיקריות:
  - cabins          -- צימרים
  - bookings        -- הזמנות
  - customers       -- לקוחות
  - pricing_rules   -- כללי תמחור
  - transactions    -- תשלומים
  - notifications   -- הודעות
  - audit_log       -- לוג פעולות
```

### Cache & Locks

#### Redis 7+

```
🎯 שימושים:
  ├─ Hold management (נעילות זמניות)
  ├─ Session storage (סשנים)
  ├─ Rate limiting (הגבלת קצב)
  ├─ Cache (מטמון)
  └─ Queue (תור משימות)

⚙️ הגדרות מומלצות:
  - Persistence: RDB + AOF
  - Max memory policy: allkeys-lru
  - Timeout: בהתאם לצורך
```

### Tasks & Automation

```yaml
# אופציה 1: Celery (Python) ⭐ מומלץ
תזמון משימות:
  - תזכורות
  - דוחות תקופתיים
  - ניקוי Hold שתפגו
  - שליחת הודעות
  - עדכון סטטיסטיקות

# אופציה 2: BullMQ (Node.js)
תזמון משימות:
  - כנ"ל
  - ממשק ניהול מובנה
  - Retry logic
  - Priority queues
```

### Calendar Integration

#### Google Calendar API v3

```javascript
🗓️ ארכיטקטורה:
  - יומן נפרד לכל צימר
  - שם ברור: "Cabin 1 - Romantic"
  - צבע שונה לכל סטטוס
  - סנכרון דו-כיווני

📋 סטטוסים:
  ├─ HOLD (צהוב) - שריון זמני
  ├─ CONFIRMED (ירוק) - אושר ושולם
  ├─ CANCELLED (אדום) - בוטל
  └─ MAINTENANCE (אפור) - תחזוקה

🔐 הרשאות:
  - Service Account עם גישה מלאה
  - OAuth2 לחיבור משתמשים
```

### Payment Processing

```
אופציות סליקה:
════════════════

🌍 בינלאומי:
┌─────────────────────────────┐
│ Stripe ⭐ מומלץ              │
│ ✓ API מצוינת                │
│ ✓ Webhooks אמינים           │
│ ✓ תיעוד מעולה               │
│ ✓ Dashboard נוח              │
└─────────────────────────────┘

🇮🇱 ישראלי:
┌─────────────────────────────┐
│ Tranzila / Cardcom / Yaad   │
│ ✓ תמיכה בעברית              │
│ ✓ שקלים                     │
│ ✓ אישורים ישראלים           │
└─────────────────────────────┘

🔔 Webhooks חובה:
  - payment.succeeded
  - payment.failed
  - refund.created
```

### Telephony

#### Twilio Voice

```
📞 יכולות:
  ├─ IVR מתקדם
  ├─ Speech-to-Text
  ├─ Text-to-Speech בעברית
  ├─ הקלטת שיחות
  └─ ניתוב חכם

🎤 זרימת שיחה:
  1. ברוכים הבאים
  2. זיהוי כוונה (NLU)
  3. איסוף פרטים
  4. בדיקת זמינות
  5. אישור הזמנה
  6. העברה לאדם במידת הצורך
```

### Workflow Automation

#### n8n / Make (Integromat)

```
🔄 אוטומציות:
  ├─ שליחת הודעות
  ├─ עדכון CRM
  ├─ סנכרון נתונים
  ├─ דוחות אוטומטיים
  └─ אינטגרציות צד ג'

💡 יתרונות:
  ✓ Low-code / No-code
  ✓ ויזואלי וקל לתחזוקה
  ✓ מאות אינטגרציות
  ✓ Self-hosted אופציה
```

---

## 🚀 תוכנית בנייה שלב אחר שלב

> **עקרון זהב:** לא מדלגים על שלבים. כל שלב חייב להיבדק ולעבוד לפני המעבר הבא.

### 📘 שלב 1: מודל נתונים (Database Schema)

**⏱️ זמן משוער:** 2-3 ימים  
**🎯 מטרה:** יצירת מסד נתונים מוצק ומדויק

#### משימות

```sql
-- טבלה: cabins (צימרים)
CREATE TABLE cabins (
    id UUID PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    area VARCHAR(50),
    max_adults INT,
    max_kids INT,
    features JSONB,
    base_price_night DECIMAL(10,2),
    weekend_price DECIMAL(10,2),
    images_urls TEXT[],
    calendar_id VARCHAR(255) UNIQUE,
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- טבלה: bookings (הזמנות)
CREATE TABLE bookings (
    id UUID PRIMARY KEY,
    cabin_id UUID REFERENCES cabins(id),
    customer_id UUID REFERENCES customers(id),
    check_in DATE NOT NULL,
    check_out DATE NOT NULL,
    adults INT,
    kids INT,
    status VARCHAR(20), -- hold, confirmed, cancelled
    total_price DECIMAL(10,2),
    created_at TIMESTAMP,
    updated_at TIMESTAMP
);

-- טבלה: customers (לקוחות)
CREATE TABLE customers (
    id UUID PRIMARY KEY,
    name VARCHAR(100),
    email VARCHAR(100) UNIQUE,
    phone VARCHAR(20),
    created_at TIMESTAMP
);

-- טבלאות נוספות: pricing_rules, transactions, notifications, audit_log
```

#### Definition of Done

- [ ] כל הטבלאות נוצרו
- [ ] קשרים (Relations) מוגדרים
- [ ] Indexes על שדות חיפוש
- [ ] Constraints מוגדרים
- [ ] נתוני דמה הוכנסו והוצאו בהצלחה

#### איך לבדוק את שלב 1?

**1. התקן חבילות נדרשות:**
```bash
pip install psycopg2-binary python-dotenv
```

**2. הגדר משתני סביבה (צור קובץ `.env`):**
```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=zimmerbot_db
DB_USER=postgres
DB_PASSWORD=postgres
```

**3. צור את מסד הנתונים:**
```bash
psql -U postgres
CREATE DATABASE zimmerbot_db;
\q
```

**4. הרץ את סקריפט ה-SQL:**
```bash
psql -U postgres -d zimmerbot_db -f database/schema.sql
```

**5. הרץ את סקריפט הבדיקה:**
```bash
# Windows
database\run_check.bat

# Linux/Mac
chmod +x database/run_check.sh
./database/run_check.sh

# או ישירות:
python database/check_stage1.py
```

📖 **לפרטים נוספים:** ראה `database/README.md`

---

### 📅 שלב 2: חיבור ליומן וזמינות

**⏱️ זמן משוער:** 3-4 ימים  
**🎯 מטרה:** קריאה וכתיבה ליומן Google Calendar

#### משימות

**1. יצירת Service Account ב-Google Cloud**

```bash
1. יצירת פרויקט ב-Google Cloud Console
2. הפעלת Google Calendar API
3. יצירת Service Account
4. הורדת credentials.json
```

**2. יצירת יומנים**

```javascript
// צור יומן לכל צימר
for (let cabin of cabins) {
    const calendar = await createCalendar({
        summary: `Cabin ${cabin.id} - ${cabin.name}`,
        timeZone: 'Asia/Jerusalem'
    });
    
    // שמור calendar_id ב-DB
    await updateCabin(cabin.id, { 
        calendar_id: calendar.id 
    });
}
```

**3. בדיקת זמינות**

```javascript
async function checkAvailability(cabinId, checkIn, checkOut) {
    const calendar = await getCalendarForCabin(cabinId);
    
    const events = await calendar.events.list({
        calendarId: calendar.id,
        timeMin: checkIn,
        timeMax: checkOut,
        singleEvents: true
    });
    
    // אם יש אירועים = תפוס
    return events.data.items.length === 0;
}
```

#### Definition of Done

- [ ] יומן נוצר לכל צימר
- [ ] חיבור API עובד
- [ ] שאילתת זמינות מחזירה תוצאות נכונות
- [ ] הוספת אירוע בדיקה עובדת
- [ ] מחיקת אירוע עובדת

---

### 💰 שלב 3: מנוע תמחור

**⏱️ זמן משוער:** 4-5 ימים  
**🎯 מטרה:** חישוב מחירים דינמי לפי כללים

#### משימות

```javascript
class PricingEngine {
    async calculatePrice(cabin, checkIn, checkOut, guests, addons) {
        let basePrice = cabin.base_price_night;
        let nights = this.calculateNights(checkIn, checkOut);
        
        // תמחור לפי יום בשבוע
        for (let date of this.dateRange(checkIn, checkOut)) {
            if (this.isWeekend(date)) {
                basePrice += cabin.weekend_surcharge;
            }
            if (this.isHoliday(date)) {
                basePrice += cabin.holiday_surcharge;
            }
        }
        
        // תוספות
        let addonsTotal = 0;
        for (let addon of addons) {
            addonsTotal += addon.price;
        }
        
        // הנחות
        let discount = 0;
        if (nights >= 7) {
            discount = basePrice * nights * 0.1; // 10% הנחה
        }
        
        let subtotal = (basePrice * nights) + addonsTotal;
        let total = subtotal - discount;
        
        return {
            base_price: basePrice,
            nights: nights,
            addons: addonsTotal,
            discount: discount,
            subtotal: subtotal,
            total: total
        };
    }
}
```

#### Definition of Done

- [ ] חישוב מחיר בסיסי עובד
- [ ] תמחור סופ"ש עובד
- [ ] תמחור חגים עובד
- [ ] תוספות מחושבות נכון
- [ ] הנחות מיושמות
- [ ] טסטים עוברים

---

### 🔒 שלב 4: Hold למניעת דאבל בוקינג

**⏱️ זמן משוער:** 3-4 ימים  
**🎯 מטרה:** מנגנון נעילה זמני של צימרים

#### משימות

```javascript
// שימוש ב-Redis לניהול Holds
class HoldManager {
    constructor(redis) {
        this.redis = redis;
        this.HOLD_DURATION = 15 * 60; // 15 דקות
    }
    
    async createHold(cabinId, checkIn, checkOut, customerId) {
        const holdKey = `hold:${cabinId}:${checkIn}:${checkOut}`;
        
        // בדוק אם יש Hold קיים
        const existing = await this.redis.get(holdKey);
        if (existing) {
            throw new Error('Cabin is already on hold');
        }
        
        // צור Hold חדש
        const holdData = {
            cabin_id: cabinId,
            customer_id: customerId,
            check_in: checkIn,
            check_out: checkOut,
            created_at: new Date().toISOString()
        };
        
        await this.redis.setex(
            holdKey,
            this.HOLD_DURATION,
            JSON.stringify(holdData)
        );
        
        // צור אירוע "HOLD" ביומן
        await this.createCalendarHold(cabinId, checkIn, checkOut);
        
        return holdData;
    }
    
    async releaseHold(cabinId, checkIn, checkOut) {
        const holdKey = `hold:${cabinId}:${checkIn}:${checkOut}`;
        await this.redis.del(holdKey);
        await this.removeCalendarHold(cabinId, checkIn, checkOut);
    }
    
    async convertHoldToBooking(holdData, paymentId) {
        // המר Hold להזמנה אמיתית
        await this.releaseHold(
            holdData.cabin_id,
            holdData.check_in,
            holdData.check_out
        );
        
        // צור הזמנה ב-DB
        const booking = await this.createBooking({
            ...holdData,
            payment_id: paymentId,
            status: 'confirmed'
        });
        
        // עדכן יומן לסטטוס CONFIRMED
        await this.updateCalendarEvent(
            holdData.cabin_id,
            holdData.check_in,
            holdData.check_out,
            'CONFIRMED'
        );
        
        return booking;
    }
}
```

#### Definition of Done

- [ ] Hold נוצר ב-Redis
- [ ] Hold נוצר ביומן
- [ ] Hold מתפוגג אוטומטית אחרי 15 דקות
- [ ] Hold ניתן לשחרור ידני
- [ ] המרה ל-booking עובדת
- [ ] לא ניתן ליצור Hold כפול

---

### 💳 שלב 5: תשלום + אימות Webhooks

**⏱️ זמן משוער:** 5-6 ימים  
**🎯 מטרה:** אינטגרציה מלאה עם ספק סליקה

#### משימות

**1. יצירת חיוב**

```javascript
async function createPaymentIntent(booking, holdData) {
    const paymentIntent = await stripe.paymentIntents.create({
        amount: booking.total_price * 100, // באגורות
        currency: 'ils',
        metadata: {
            booking_id: booking.id,
            cabin_id: holdData.cabin_id,
            customer_id: holdData.customer_id
        },
        description: `הזמנה: ${holdData.cabin_id} | ${holdData.check_in}`
    });
    
    return {
        client_secret: paymentIntent.client_secret,
        payment_id: paymentIntent.id
    };
}
```

**2. Webhook Handler**

```javascript
app.post('/webhooks/stripe', async (req, res) => {
    const sig = req.headers['stripe-signature'];
    let event;
    
    try {
        event = stripe.webhooks.constructEvent(
            req.body,
            sig,
            process.env.STRIPE_WEBHOOK_SECRET
        );
    } catch (err) {
        return res.status(400).send(`Webhook Error: ${err.message}`);
    }
    
    if (event.type === 'payment_intent.succeeded') {
        const paymentIntent = event.data.object;
        
        // המר Hold להזמנה מאושרת
        await convertHoldToBooking(
            paymentIntent.metadata.booking_id,
            paymentIntent.id
        );
        
        // שלח הודעת אישור
        await sendConfirmationEmail(
            paymentIntent.metadata.customer_id
        );
    }
    
    res.json({ received: true });
});
```

#### Definition of Done

- [ ] יצירת חיוב עובדת
- [ ] קישור תשלום נשלח ללקוח
- [ ] Webhook מקבל אירועים
- [ ] תשלום מאומת מעדכן DB
- [ ] Hold מומר אוטומטית להזמנה
- [ ] החזר כספי עובד

---

### 📨 שלב 6: הודעות ותזכורות

**⏱️ זמן משוער:** 4-5 ימים  
**🎯 מטרה:** שליחת הודעות אוטומטיות בזמנים נכונים

#### משימות

```javascript
// תור משימות עם Celery/BullMQ
const notificationQueue = new Queue('notifications');

// הוספת משימה לתור
async function scheduleNotifications(booking) {
    // אישור מיידי
    await notificationQueue.add('confirmation', {
        booking_id: booking.id,
        type: 'email',
        template: 'booking_confirmation'
    }, { delay: 0 });
    
    // תזכורת 3 ימים לפני
    const reminderDate = moment(booking.check_in).subtract(3, 'days');
    await notificationQueue.add('reminder', {
        booking_id: booking.id,
        type: 'email',
        template: 'arrival_reminder'
    }, { delay: reminderDate.diff(moment()) });
    
    // הוראות הגעה ביום ההגעה
    const arrivalDate = moment(booking.check_in).hour(8);
    await notificationQueue.add('directions', {
        booking_id: booking.id,
        type: 'sms',
        template: 'arrival_directions'
    }, { delay: arrivalDate.diff(moment()) });
    
    // הודעת תודה אחרי יציאה
    const thankYouDate = moment(booking.check_out).add(1, 'day');
    await notificationQueue.add('thank_you', {
        booking_id: booking.id,
        type: 'email',
        template: 'thank_you_review'
    }, { delay: thankYouDate.diff(moment()) });
}

// Worker שמטפל בהודעות
notificationQueue.process(async (job) => {
    const { booking_id, type, template } = job.data;
    
    const booking = await getBooking(booking_id);
    const customer = await getCustomer(booking.customer_id);
    
    if (type === 'email') {
        await sendEmail(customer.email, template, booking);
    } else if (type === 'sms') {
        await sendSMS(customer.phone, template, booking);
    }
});
```

#### Definition of Done

- [ ] אישור הזמנה נשלח מיידית
- [ ] תזכורת נשלחת 3 ימים לפני
- [ ] הוראות הגעה נשלחות ביום ההגעה
- [ ] הודעת תודה נשלחת אחרי יציאה
- [ ] התראות לבעל הצימר עובדות
- [ ] לוג של כל ההודעות

---

### 💬 שלב 7: חיבור צ'אט באתר

**⏱️ זמן משוער:** 5-7 ימים  
**🎯 מטרה:** ממשק צ'אט מלא עם AI

#### משימות

**1. Frontend - Widget צ'אט**

```html
<div id="chat-widget">
    <div id="chat-messages"></div>
    <input id="chat-input" placeholder="שאל אותי משהו..." />
    <button id="chat-send">שלח</button>
</div>
```

**2. Backend - Chatbot Logic**

```javascript
class ChatbotHandler {
    async handleMessage(message, sessionId) {
        const intent = await this.detectIntent(message);
        
        switch (intent) {
            case 'search_availability':
                return await this.handleSearchIntent(message, sessionId);
            
            case 'get_pricing':
                return await this.handlePricingIntent(message, sessionId);
            
            case 'make_booking':
                return await this.handleBookingIntent(message, sessionId);
            
            case 'ask_question':
                return await this.handleQuestionIntent(message, sessionId);
            
            default:
                return this.handleFallback(message);
        }
    }
    
    async handleSearchIntent(message, sessionId) {
        // חלץ תאריכים ופרטים מההודעה
        const params = await this.extractParameters(message);
        
        if (!params.checkIn || !params.checkOut) {
            return {
                type: 'question',
                text: 'אשמח לעזור! מתי תרצה להגיע?',
                quick_replies: ['סופ"ש הקרוב', 'השבוע הבא']
            };
        }
        
        // חפש צימרים פנויים
        const available = await this.searchAvailability(params);
        
        return {
            type: 'cabin_results',
            cabins: available,
            text: `מצאתי ${available.length} צימרים פנויים!`
        };
    }
}
```

#### Definition of Done

- [ ] Widget צ'אט מוטמע באתר
- [ ] זיהוי כוונות (NLU) עובד
- [ ] שיחה מלאה עד הזמנה עובדת
- [ ] הצגת תמונות ופרטים
- [ ] העברה לאדם עובדת
- [ ] סשנים נשמרים

---

### 📞 שלב 8: חיבור סוכן קולי

**⏱️ זמן משוער:** 7-10 ימים  
**🎯 מטרה:** סוכן קולי טלפוני מלא

#### משימות

```javascript
// Twilio Voice Handler
app.post('/voice/incoming', (req, res) => {
    const twiml = new twilio.twiml.VoiceResponse();
    
    // הודעת פתיחה
    twiml.say({
        voice: 'Polly.Tatyana',
        language: 'he-IL'
    }, 'שלום וברוכים הבאים לצימרים שלנו. איך אוכל לעזור?');
    
    // הקלטת תשובה
    twiml.gather({
        input: 'speech',
        language: 'he-IL',
        speechTimeout: 'auto',
        action: '/voice/process'
    });
    
    res.type('text/xml');
    res.send(twiml.toString());
});

app.post('/voice/process', async (req, res) => {
    const speech = req.body.SpeechResult;
    const callSid = req.body.CallSid;
    
    // עבד את הדיבור
    const response = await chatbot.handleMessage(speech, callSid);
    
    const twiml = new twilio.twiml.VoiceResponse();
    
    if (response.transfer_to_human) {
        twiml.say('מעביר אותך לנציג...');
        twiml.dial(process.env.AGENT_PHONE);
    } else {
        twiml.say({
            voice: 'Polly.Tatyana',
            language: 'he-IL'
        }, response.text);
        
        // המשך שיחה
        twiml.gather({
            input: 'speech',
            language: 'he-IL',
            action: '/voice/process'
        });
    }
    
    res.type('text/xml');
    res.send(twiml.toString());
});
```

#### Definition of Done

- [ ] שיחה נכנסת מטופלת
- [ ] Speech-to-Text עובד בעברית
- [ ] Text-to-Speech עובד בעברית
- [ ] זרימת שיחה מלאה עובדת
- [ ] העברה לאדם עובדת
- [ ] הקלטת שיחות

---

### 📊 שלב 9: דשבורד ניהול

**⏱️ זמן משוער:** 7-10 ימים  
**🎯 מטרה:** ממשק ניהול מלא לבעל הצימר

#### תכונות

```
┌─────────────────────────────────────────┐
│  🏠 Dashboard                            │
├─────────────────────────────────────────┤
│                                         │
│  📊 היום                                │
│  ├─ הזמנות חדשות: 3                     │
│  ├─ check-in: 2                         │
│  ├─ check-out: 1                        │
│  └─ הכנסות: ₪2,400                      │
│                                         │
│  📅 לוח שנה                             │
│  [תצוגה חודשית עם תפוסה]                │
│                                         │
│  💰 הכנסות                              │
│  [גרף הכנסות לפי חודש]                  │
│                                         │
│  📋 הזמנות אחרונות                      │
│  [טבלה עם הזמנות + סטטוס]              │
│                                         │
│  ⚙️ הגדרות                              │
│  ├─ ניהול צימרים                        │
│  ├─ כללי תמחור                          │
│  ├─ תוספות וחבילות                     │
│  └─ משתמשים והרשאות                     │
│                                         │
└─────────────────────────────────────────┘
```

#### Definition of Done

- [ ] לוח בקרה עם נתונים חיים
- [ ] תצוגת לוח שנה
- [ ] ניהול הזמנות (עריכה, ביטול)
- [ ] דוחות KPI
- [ ] ניהול תמחור
- [ ] ניהול משתמשים
- [ ] לוג פעולות

---

### ⚡ שלב 10: שדרוגים חכמים ואופטימיזציה

**⏱️ זמן משוער:** 5-7 ימים  
**🎯 מטרה:** שיפור ביצועים וחוויית משתמש

#### שיפורים

**ביצועים:**
- Cache תוצאות חיפוש נפוצות
- אופטימיזציה של שאילתות DB
- CDN לתמונות
- Lazy loading

**חוויית משתמש:**
- חיפוש מתקדם עם פילטרים
- המלצות מותאמות אישית
- השוואה בין צימרים
- ביקורות ודירוגים

**אנליטיקס:**
- Google Analytics
- מעקב אחר המרות
- Heatmaps
- A/B Testing

---

## 🏁 התחלה מהירה

### דרישות מקדימות

```bash
# Backend
- Python 3.10+ / Node.js 18+
- PostgreSQL 15+
- Redis 7+

# Cloud Services
- Google Cloud Platform (Calendar API)
- Stripe / Tranzila (תשלומים)
- Twilio (טלפוניה)
- SendGrid / AWS SES (אימייל)
```

### התקנה מהירה

```bash
# Clone repository
git clone https://github.com/yourusername/cabin-booking-ai.git
cd cabin-booking-ai

# Install dependencies
pip install -r requirements.txt  # Python
# OR
npm install  # Node.js

# Setup environment
cp .env.example .env
# Edit .env with your credentials

# Run migrations
python manage.py migrate  # Python
# OR
npm run migrate  # Node.js

# Start development server
python manage.py runserver  # Python
# OR
npm run dev  # Node.js
```

---

## 📊 מצב פרויקט והצעד הבא

**תאריך עדכון אחרון:** 2025-12-26

### 📈 התקדמות כללית

```
שלב 1: מודל נתונים        [██████████] 100% ✅ הושלם
שלב 2: חיבור ליומן         [██████████] 100% ✅ הושלם
שלב 3: מנוע תמחור          [██████████] 100% ✅ הושלם
שלב 4: מנגנון Hold          [██████████] 100% ✅ הושלם
שלב 5: תשלומים             [░░░░░░░░░░]   0% ⏳ הבא
שלב 6: הודעות               [░░░░░░░░░░]   0%
שלב 7: צ'אט באתר            [░░░░░░░░░░]   0%
שלב 8: סוכן קולי            [░░░░░░░░░░]   0%
שלב 9: דשבורד               [░░░░░░░░░░]   0%
שלב 10: אופטימיזציה         [░░░░░░░░░░]   0%

סה"כ: 40% הושלם (4 מתוך 10 שלבים)
```

### ✅ שלבים שהושלמו

#### 📘 שלב 1: מודל נתונים - **100% הושלם**

**מה הושלם:**
- ✅ כל הטבלאות נוצרו (`cabins`, `bookings`, `customers`, `pricing_rules`, `transactions`, `notifications`, `audit_log`)
- ✅ קשרים (Foreign Keys) מוגדרים
- ✅ Indexes על שדות חיפוש
- ✅ Constraints מוגדרים
- ✅ Triggers ל-`updated_at`
- ✅ בדיקות אוטומטיות (`database/check_stage1.py`)

**קבצים:**
- `database/schema.sql` - Schema מלא
- `database/check_stage1.py` - בדיקות אוטומטיות
- `database/run_check_stage1.bat` - הרצה מהירה

**איך לבדוק:**
```bash
database\run_check_stage1.bat
```

---

#### 📅 שלב 2: חיבור ליומן וזמינות - **100% הושלם**

**מה הושלם:**
- ✅ חיבור ל-Google Calendar API
- ✅ קריאת צימרים מ-Google Sheets
- ✅ בדיקת זמינות (`/availability` endpoint)
- ✅ יצירת אירועים (`/book` endpoint)
- ✅ מחיקת אירועים (לבדיקות)
- ✅ OAuth2 authentication
- ✅ בדיקות אוטומטיות (`database/check_stage2.py`)

**קבצים:**
- `src/main.py` - לוגיקה של Calendar API
- `src/api_server.py` - FastAPI endpoints
- `database/check_stage2.py` - בדיקות אוטומטיות

**Endpoints:**
- `POST /availability` - בדיקת זמינות
- `POST /book` - יצירת הזמנה

**איך לבדוק:**
```bash
database\run_check_stage2.bat
```

---

#### 💰 שלב 3: מנוע תמחור - **100% הושלם**

**מה הושלם:**
- ✅ `PricingEngine` class - מנוע תמחור מתקדם
- ✅ תמיכה בסופ"ש (+30% או מחיר נפרד)
- ✅ תמיכה בחגים (+50%)
- ✅ תמיכה בעונה גבוהה (+20%)
- ✅ תמיכה בעונת חגים (+30%)
- ✅ הנחות לפי משך שהות (4 לילות = 5%, שבוע = 10%, חודש = 15%)
- ✅ תמיכה בתוספות (addons)
- ✅ `/quote` endpoint - הצעת מחיר מפורטת
- ✅ Breakdown מפורט לכל יום
- ✅ בדיקות אוטומטיות (`database/check_stage3.py`)
- ✅ `features_picker.html` - זרימה מלאה עם טבלת מחירים

**קבצים:**
- `src/pricing.py` - PricingEngine class
- `src/api_server.py` - `/quote` endpoint
- `tools/features_picker.html` - UI מלא עם:
  - בדיקת זמינות
  - בחירת צימר
  - הצעת מחיר מפורטת
  - בחירת addons
  - יצירת הזמנה
- `database/check_stage3.py` - בדיקות אוטומטיות

**Endpoints:**
- `POST /quote` - הצעת מחיר מפורטת עם breakdown

**איך לבדוק:**
```bash
database\run_check_stage3.bat
```

**מה עובד:**
- ✅ חישוב מחיר בסיסי
- ✅ תמחור סופ"ש
- ✅ תמחור חגים
- ✅ תמחור עונה גבוהה
- ✅ הנחות לפי משך שהות
- ✅ תוספות (addons)
- ✅ Breakdown מפורט

---

### ✅ שלב 4: מנגנון Hold - **100% הושלם**

**מה הושלם:**
- ✅ Redis Integration - חיבור ל-Redis לניהול Holds
- ✅ HoldManager class - יצירה, שחרור, המרה
- ✅ API Endpoints - `/hold`, `/hold/{id}`, `DELETE /hold/{id}`
- ✅ Calendar Integration - אירועי HOLD ביומן
- ✅ Database Integration - שמירת לקוחות והזמנות ב-DB
- ✅ `/book` endpoint - תמיכה ב-Hold conversion
- ✅ Fallback behavior - עובד גם בלי Redis (עם אזהרה)
- ✅ בדיקות אוטומטיות (`database/check_stage4.py`)

**קבצים:**
- `src/hold.py` - HoldManager class
- `src/db.py` - Database connection and utilities
- `database/import_cabins_to_db.py` - Import cabins from Sheets to DB
- `database/check_stage4.py` - בדיקות אוטומטיות

**Endpoints:**
- `POST /hold` - יצירת Hold
- `GET /hold/{hold_id}` - בדיקת סטטוס Hold
- `DELETE /hold/{hold_id}` - שחרור Hold
- `POST /book` - יצירת הזמנה (עם תמיכה ב-Hold)

**איך לבדוק:**
```bash
database\run_check_stage4.bat
```

**איך לייבא צימרים ל-DB:**
```bash
database\run_import_cabins.bat
```

📋 **לפרטים מלאים:** ראה `docs/STAGE4_HOLD_GUIDE.md`

---

---

### 💾 מה נשמר ב-DB כרגע?

**✅ חלקית!** - המערכת שומרת חלק מהנתונים ב-DB:

**מה נשמר:**
- ✅ `customers` - שמירת לקוחות חדשים (אוטומטי ב-`/book`)
- ✅ `bookings` - שמירת כל הזמנה אחרי `/book` (אוטומטי)
- ⏳ `cabins` - ניתן לייבא מ-Google Sheets ל-DB (סקריפט מוכן)
- ❌ `pricing_rules` - עדיין hardcoded (שלב עתידי)
- ❌ `transactions` - אחרי שלב 5 (תשלומים)

**איך לייבא צימרים ל-DB:**
```bash
database\run_import_cabins.bat
```

📋 **לפרטים מלאים:** ראה `docs/PROJECT_STATUS.md`, `docs/INTEGRATION_GUIDE.md`, ו-`docs/STAGE4_HOLD_GUIDE.md`

---

### ⏳ השלב הבא: שלב 5 - תשלומים

**⏱️ זמן משוער:** 5-6 ימים  
**🎯 מטרה:** אינטגרציה מלאה עם ספק סליקה  
**🛠️ כלי:** Cursor (Python + FastAPI + Stripe/Tranzila)

#### מה צריך לבנות:

**1. Payment Gateway Integration:**
- יצירת חיוב (Payment Intent)
- קישור תשלום
- Webhook handler לאימות תשלומים

**2. Transaction Management:**
- שמירת תשלומים ב-DB
- עדכון סטטוס הזמנה אחרי תשלום
- ניהול החזרים

**3. Hold Conversion:**
- המרת Hold להזמנה אחרי תשלום מוצלח
- שחרור Hold אם תשלום נכשל

#### Definition of Done:
- [ ] יצירת חיוב עובדת
- [ ] קישור תשלום נשלח ללקוח
- [ ] Webhook מקבל אירועים
- [ ] תשלום מאומת מעדכן DB
- [ ] Hold מומר אוטומטית להזמנה
- [ ] החזר כספי עובד

---

### 🎉 הישגים עד כה

✅ **4 שלבים הושלמו בהצלחה!**
- מודל נתונים מוצק
- חיבור ליומן עובד
- מנוע תמחור מתקדם

✅ **UI מלא:**
- `features_picker.html` עם זרימה מלאה
- טבלת מחירים מפורטת
- בחירת addons
- יצירת הזמנות

✅ **API עובד:**
- `/health` - בדיקת בריאות
- `/cabins` - רשימת צימרים
- `/availability` - בדיקת זמינות
- `/quote` - הצעת מחיר
- `/book` - יצירת הזמנה

---

## 📞 צור קשר ותמיכה

**מפתח הפרויקט:** [אלדד גונשרוביץ]  
**אימייל:** eldadi9@gmail.com  
**GitHub:** [@eldadi9](https://github.com/eldadi9)

---

## 📄 רישיון

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

<div align="center">

**נבנה באהבה ❤️ עם הרבה קפה ☕**

[⬆ חזרה למעלה](#-מערכת-הזמנות-אוטומטית-לצימרים)

</div>
